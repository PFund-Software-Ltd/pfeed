[workspace]
authors = ["softwareentrepreneer <softwareentrepreneer+pfeed@gmail.com>"]
channels = ["conda-forge"]
name = "pfeed"
platforms = ["osx-arm64", "linux-64"]
# updating this needs to also update the version in the ci.yml and templates/ci-workflow-template.yml files
requires-pixi = ">=0.63.2"  # command: pixi workspace requires-pixi set ">=0.63.2"

[tasks]

[tasks.test-all]
depends-on = [
  { task = "test", environment = "py311" },
  { task = "test", environment = "py312" },
  { task = "test", environment = "py313" },
]

[dependencies]
python = ">=3.11.14"
uv = ">=0.10.4"
openjdk = "21.*"  # for spark
libpq = ">=18.1"  # for postgresql
gh = ">=2.87.2"

[pypi-dependencies]
# TEMP
pfeed = { path = ".", editable = true }
pfund = { path = "../pfund", editable = true }
pfund-kit = { path = "../pfund-kit", editable = true }
# pfund = ">=0.0.2"
pandas = ">=2.3.3,<3.0.0"
polars = ">=1.38.1"
pyarrow = ">=23.0.1"
pandera = ">=0.29.0"
msgspec = ">=0.20.0"
pydantic = ">=2.12.5"
narwhals = ">=2.17.0"
zstandard = ">=0.25.0"
beautifulsoup4 = ">=4.14.3"
cloudpathlib = { version = ">=0.23.0", extras = ["s3", "gs", "azure"] }
ray = { version = ">=2.54.0", extras = ["default"] }
pyzmq = ">=27.1.0"
deltalake = ">=1.4.2"

[environments]
default = ["py311", "dev", "optional"]
py311 = ["py311", "test", "optional"]
py312 = ["py312", "test", "optional"]
py313 = ["py313", "test", "optional"]

[activation.env]
JAVA_HOME = "$CONDA_PREFIX/lib/jvm"
JDK_HOME  = "$JAVA_HOME"
PATH      = "$JAVA_HOME/bin:$PATH"

[feature.optional.pypi-dependencies]
# TEMP
# fmp-api-client = ">=0.0.1download"
yfinance = ">=1.2.0"
prefect = ">=3.6.19"
huggingface-hub = ">=1.4.1"
dask = { version = ">=2026.1.2", extras = ["complete", "dataframe"] }
pyspark = { version = ">=4.1.1", extras = ["connect", "pandas-on-spark", "sql"] }
duckdb = ">=1.4.4"
lancedb = ">=0.29.2"
# psycopg = { version = ">=3.3.3", extras = ["binary", "pool"] }

# TEMP
[pypi-options.dependency-overrides]
pfeed = { path = ".", editable = true }
pfund = { path = "../pfund", editable = true }
pfund-plot = { path = "../pfund-plot", editable = true, extras = ["marimo"] }
pfund-kit = { path = "../pfund-kit", editable = true }

[feature.dev.pypi-dependencies]
pfeed = { path = ".", editable = true }
afterpython = ">=0.2.1"
basedpyright = ">=1.38.1"
pandas-stubs = ">=2.3.3.260113"
# TEMP
pfund-plot = { path = "../pfund-plot", editable = true, extras = ["marimo"] }
financetoolkit = ">=2.0.6"

[feature.test.pypi-dependencies]
pytest = ">=9.0.2"
pytest-cov = ">=7.0.0"
pytest-mock = ">=3.15.1"
pytest-xdist = ">=3.8.0"
pytest-asyncio = ">=1.3.0"
pytest-recording = ">=0.13.4"
testcontainers = ">=4.13.3"
[feature.test.tasks]
test = "pytest -n auto -m 'not rate_limit'"
test-rate-limit = "pytest -m 'rate_limit'"
test-new = "pytest --record-mode=all"  # record new interactions, useful to update recordings in case data formats returned have changed
test-ci = "pytest --record-mode=none"  # fail a test if no recording is found

[feature.py311.dependencies]
python = "3.11.*"

[feature.py312.dependencies]
python = "3.12.*"

[feature.py313.dependencies]
python = "3.13.*"
